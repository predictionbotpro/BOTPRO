<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üöÄ Robot de Pr√©diction Pro</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <style>
    /* Animations */
    .animate-pulse {
        animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }

    @keyframes pulse {
        0%, 100% {
            opacity: 1;
        }
        50% {
            opacity: .5;
        }
    }

    .animate-bounce {
        animation: bounce 1s infinite;
    }

    @keyframes bounce {
        0%, 100% {
            transform: translateY(-25%);
            animation-timing-function: cubic-bezier(0.8, 0, 1, 1);
        }
        50% {
            transform: translateY(0);
            animation-timing-function: cubic-bezier(0, 0, 0.2, 1);
        }
    }

    /* Responsive et Scroll Styles */
    @media (max-width: 768px) {
        #loginModal {
            padding: 0;
        }
        
        #loginModal > div {
            min-height: 100%;
            padding: 1rem;
        }
        
        #loginModal > div > div {
            margin: 0;
            max-height: 100vh;
            overflow-y: auto;
        }
    }

    @media (min-width: 769px) {
        #loginModal > div > div {
            max-height: 90vh;
            overflow-y: auto;
            margin: 2rem auto;
        }
    }

    #loginModal > div > div::-webkit-scrollbar {
        width: 8px;
    }

    #loginModal > div > div::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 4px;
    }

    #loginModal > div > div::-webkit-scrollbar-thumb {
        background: #888;
        border-radius: 4px;
    }

    #loginModal > div > div::-webkit-scrollbar-thumb:hover {
        background: #555;
    }
    
    /* Styles du compte √† rebours */
    .countdown-container {
        margin-top: 2rem;
        padding: 1.5rem;
        background: linear-gradient(145deg, #f3f4f6, #ffffff);
        border-radius: 15px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }

    .countdown-header {
        font-size: 1.2rem;
        color: #1a73e8;
        margin-bottom: 1rem;
        font-weight: bold;
        text-align: center;
    }

    .countdown-timer {
        display: flex;
        justify-content: center;
        gap: 1rem;
    }

    .countdown-box {
        display: flex;
        flex-direction: column;
        align-items: center;
        min-width: 80px;
        padding: 0.8rem;
        background: white;
        border-radius: 10px;
        box-shadow: 0 2px 8px rgba(26, 115, 232, 0.1);
        transition: transform 0.3s ease;
    }

    .countdown-box:hover {
        transform: translateY(-2px);
    }

    .countdown-box span {
        font-size: 1.8rem;
        font-weight: bold;
        color: #1a73e8;
        margin-bottom: 0.3rem;
    }

    .countdown-box label {
        font-size: 0.8rem;
        color: #666;
        text-transform: uppercase;
    }

    @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.05); }
        100% { transform: scale(1); }
    }

    .countdown-box.urgent span {
        color: #dc3545;
        animation: pulse 1s infinite;
    }
    
    .coefficient-badge {
        display: inline-block;
        background: linear-gradient(145deg, #3B82F6, #1E40AF);
        color: white;
        border-radius: 9999px;
        padding: 0.25rem 0.75rem;
        font-size: 0.875rem;
        margin: 0.25rem;
        animation: fadeIn 0.3s ease-out;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; transform: scale(0.8); }
        to { opacity: 1; transform: scale(1); }
    }
    
    .auto-fetch-container {
        background: linear-gradient(145deg, #f0f4f8, #def1ff);
        border-radius: 12px;
        padding: 15px;
        margin-top: 20px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.05);
    }
    
    .auto-fetch-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
    }
    
    .auto-fetch-title {
        font-weight: bold;
        color: #1E3A8A;
    }
    
    .auto-fetch-status {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 0.875rem;
        color: #4B5563;
    }
    
    .auto-fetch-dot {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        background-color: #10B981;
    }
    
    .auto-fetch-dot.inactive {
        background-color: #EF4444;
    }
    
    .coefficients-display {
        min-height: 60px;
        background: rgba(255, 255, 255, 0.7);
        border-radius: 8px;
        padding: 10px;
        margin-top: 10px;
        border: 1px dashed #3B82F6;
    }
    
    .fetching-spinner {
        width: 20px;
        height: 20px;
        border: 3px solid rgba(59, 130, 246, 0.3);
        border-top: 3px solid #3B82F6;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        display: inline-block;
        vertical-align: middle;
        margin-right: 8px;
    }
    
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
    
    .auto-fetch-controls {
        display: flex;
        gap: 10px;
        margin-top: 15px;
    }
    
    .auto-fetch-btn {
        flex: 1;
        padding: 8px 0;
        border-radius: 8px;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s ease;
        text-align: center;
    }
    
    .auto-fetch-btn.start {
        background: linear-gradient(145deg, #10B981, #047857);
        color: white;
    }
    
    .auto-fetch-btn.stop {
        background: linear-gradient(145deg, #EF4444, #B91C1C);
        color: white;
    }
    
    .auto-fetch-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
</style>
    <!-- Firebase Scripts -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
<script>
    // Configuration Firebase
    const firebaseConfig = {
        apiKey: "AIzaSyBKkCEsvjAh9DIhBlx5tfQzM5ceTSP0Tiw",
        authDomain: "predictionbot-59e47.firebaseapp.com",
        projectId: "predictionbot-59e47",
        storageBucket: "predictionbot-59e47.firebasestorage.app",
        messagingSenderId: "804807142505",
        appId: "1:804807142505:web:da39797c5354de59ad46f8",
        measurementId: "G-9DB03YTP83"
    };

    // Initialisation Firebase
    firebase.initializeApp(firebaseConfig);
</script>
</head>
<body>
<!-- Modal de connexion avec scroll am√©lior√© -->
<div id="loginModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 overflow-y-auto">
    <div class="min-h-screen w-full py-6 flex items-center justify-center">
        <div class="bg-white rounded-2xl p-8 max-w-xl w-full mx-4 my-auto shadow-2xl relative">
            <!-- Code Promo Anim√© -->
            <div class="relative -mt-2 mb-8">
                <a href="https://t.me/betsmartbotcasino" 
                   class="block bg-gradient-to-r from-purple-600 to-pink-600 p-6 rounded-xl text-center transform hover:scale-105 transition-all duration-300">
                    <div class="absolute -top-3 -right-3 bg-red-500 text-white text-xs px-3 py-1 rounded-full animate-bounce">
                        INFORMATION IMPORTANTE 
                    </div>
                    <h3 class="text-white text-xl font-bold mb-2">üéâ invite 3 personnes √† rejoindre le canal telegram</h3>
                    <div class="bg-white/20 backdrop-blur-sm p-4 rounded-lg inline-block animate-pulse">
                        <span class="text-3xl font-bold text-white tracking-wider">BetSmartbot</span>
                    </div>
                    <p class="text-white/90 mt-3 text-sm">
                        Offre sp√©ciale : Passez √† la formule sup√©rieure !
                    </p>
                    <p class="text-yellow-300 text-sm mt-2">
                        R√©serv√© aux 100 premiers inscrits
                    </p>
                    <div class="mt-2 text-white text-xs">
                        Ex: Forfait 5.000 Fr ‚Üí Acc√®s au forfait 15.000 Fr
                    </div>
                    <div class="mt-2 text-yellow-300 text-sm animate-pulse">
                        Cliquez pour rejoindre le canal telegram ‚ûú
                    </div>
                </a>
            </div>

            <!-- En-t√™te -->
            <div class="text-center mb-8">
                <h2 class="text-3xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent mb-2">
                    üöÄ Robot de Prediction Pro
                </h2>
                <p class="text-gray-600">Intelligence Artificielle pour Pr√©dictions Optimales</p>
            </div>

            <!-- Zone de code d'acc√®s -->
            <div class="mb-8 bg-gray-50 p-6 rounded-xl border border-gray-200">
                <label class="block text-gray-700 text-sm font-bold mb-3" for="accessCode">
                    üîë Code d'acc√®s
                </label>
                <input 
                    type="text" 
                    id="accessCode"
                    class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                    placeholder="Entrez votre code d'acc√®s"
                >
            </div>
            <!-- Ajouter apr√®s la zone de code d'acc√®s -->
<div class="countdown-container" id="countdownContainer" style="display: none;">
    <div class="countdown-header">Temps restant</div>
    <div class="countdown-timer">
        <div class="countdown-box">
            <span id="days">00</span>
            <label>Jours</label>
        </div>
        <div class="countdown-box">
            <span id="hours">00</span>
            <label>Heures</label>
        </div>
        <div class="countdown-box">
            <span id="minutes">00</span>
            <label>Minutes</label>
        </div>
        <div class="countdown-box">
            <span id="seconds">00</span>
            <label>Secondes</label>
        </div>
    </div>
</div>

            <!-- Forfaits -->
            <div class="grid md:grid-cols-3 gap-6 mb-8">
                <!-- Forfait 24H -->
                <div class="relative bg-gradient-to-br from-blue-500/10 to-blue-600/10 p-6 rounded-xl border border-blue-200 backdrop-blur-sm hover:transform hover:scale-105 transition-all duration-300">
                    <div class="absolute -top-3 -right-3 bg-blue-500 text-white text-xs px-3 py-1 rounded-full">
                        24H
                    </div>
                    <h3 class="font-bold text-blue-800">Acc√®s Journalier</h3>
                    <p class="text-2xl font-bold text-blue-600 my-2">1.000 Fr</p>
                    <p class="text-sm text-blue-600">Acc√®s complet 24h</p>
                </div>

                <!-- Forfait Semaine -->
                <div class="relative bg-gradient-to-br from-purple-500/10 to-purple-600/10 p-6 rounded-xl border border-purple-200 backdrop-blur-sm hover:transform hover:scale-105 transition-all duration-300">
                    <div class="absolute -top-3 -right-3 bg-purple-500 text-white text-xs px-3 py-1 rounded-full">
                        SEMAINE
                    </div>
                    <h3 class="font-bold text-purple-800">Acc√®s Hebdomadaire</h3>
                    <p class="text-2xl font-bold text-purple-600 my-2">5.000 Fr</p>
                    <p class="text-sm text-purple-600">Acc√®s complet 7 jours</p>
                </div>

                <!-- Forfait Mois -->
                <div class="relative bg-gradient-to-br from-green-500/10 to-green-600/10 p-6 rounded-xl border border-green-200 backdrop-blur-sm hover:transform hover:scale-105 transition-all duration-300">
                    <div class="absolute -top-3 -right-3 bg-green-500 text-white text-xs px-3 py-1 rounded-full">
                        MOIS
                    </div>
                    <h3 class="font-bold text-green-800">Acc√®s Mensuel</h3>
                    <p class="text-2xl font-bold text-green-600 my-2">15.000 Fr</p>
                    <p class="text-sm text-green-600">Acc√®s complet 30 jours</p>
                </div>
            </div>

            <!-- Messages importants -->
            <div class="space-y-6 mb-8">
                <!-- Horaires et D√©lais -->
                <div class="bg-yellow-50 p-6 rounded-xl border border-yellow-200">
                    <h3 class="text-lg font-bold text-yellow-800 mb-4 flex items-center">
                        <span class="mr-2">‚è∞</span> Horaires de Service
                    </h3>
                    <div class="space-y-3 text-sm text-yellow-700">
                        <div class="flex items-start">
                            <span class="mr-2">‚Ä¢</span>
                            <p><span class="font-semibold">Heures d'ouverture :</span> 8h - 22h</p>
                        </div>
                        <div class="flex items-start">
                            <span class="mr-2">‚Ä¢</span>
                            <p><span class="font-semibold">Important :</span> Aucun traitement (appel/WhatsApp) en dehors des heures de service</p>
                        </div>
                        <div class="flex items-start">
                            <span class="mr-2">‚Ä¢</span>
                            <p class="text-yellow-800 font-medium">Les souscriptions effectu√©es hors horaires de service peuvent subir des d√©lais de traitement prolong√©s</p>
                        </div>
                    </div>
                </div>

                <!-- R√©ception du code -->
                <div class="bg-blue-50 p-6 rounded-xl border border-blue-200">
                    <h3 class="text-lg font-bold text-blue-800 mb-4 flex items-center">
                        <span class="mr-2">üîë</span> R√©ception du Code d'Acc√®s
                    </h3>
                    <div class="space-y-3 text-sm text-blue-700">
                        <p class="font-medium">Si vous n'avez pas re√ßu votre code d'acc√®s dans les 5 minutes apr√®s votre paiement :</p>
                        <div class="flex items-start">
                            <span class="mr-2">1.</span>
                            <p>Contactez le num√©ro sur lequel vous avez effectu√© le paiement</p>
                        </div>
                        <div class="flex items-start">
                            <span class="mr-2">2.</span>
                            <p>OU contactez notre support WhatsApp</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Moyens de paiement -->
            <div class="bg-gradient-to-r from-gray-50 to-gray-100 p-6 rounded-xl mb-8 border border-gray-200">
                <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                    <span class="mr-2">üí≥</span> Moyens de Paiement
                </h3>
                <div class="space-y-4">
                    <!-- Orange & Wave -->
                    <div class="flex items-center justify-between bg-white p-4 rounded-lg hover:shadow-md transition-all">
                        <div class="flex items-center space-x-4">
                            <img src="https://emoneyci-exchanges.com/uploads/1659020965_icon.jpg" alt="Orange" class="h-8 w-8 object-contain">
                            <img src="https://goamobile.com/logosent/wave@221@-P-2021-06-30_00-18-27wave_logo_2.png" alt="Wave" class="h-8 w-8 object-contain">
                            <span class="font-semibold text-gray-700">0708453461</span>
                        </div>
                    </div>

                    <!-- MTN & Wave -->
                    <div class="flex items-center justify-between bg-white p-4 rounded-lg hover:shadow-md transition-all">
                        <div class="flex items-center space-x-4">
                            <img src="https://www.telecomreviewafrica.com/images/stories/2019/06/MTN_lance_le_premier_chatbot_pour_son_service_de_mobile_money.jpg" alt="MTN" class="h-8 w-8 object-contain">
                            <img src="https://goamobile.com/logosent/wave@221@-P-2021-06-30_00-18-27wave_logo_2.png" alt="Wave" class="h-8 w-8 object-contain">
                            <span class="font-semibold text-gray-700">0506210051</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Boutons de contact -->
            <div class="grid grid-cols-2 gap-6 mb-8">
                <a href="https://t.me/betsmartbotcasino" 
                   class="flex items-center justify-center bg-blue-500 text-white py-3 px-6 rounded-xl hover:bg-blue-600 transform hover:-translate-y-1 transition-all duration-300 font-semibold">
                    <svg class="w-6 h-6 mr-2" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm5.562 8.161c-.18.717-.962 3.845-1.362 5.452-.168.674-.374 1.193-.611 1.555-.238.362-.455.517-.65.465-.414-.11-.92-.44-1.518-.989-.842-.766-1.318-1.242-2.113-1.989-.935-.874-.329-1.355.204-2.141.139-.205 2.555-2.342 2.601-2.542.006-.025.011-.119-.044-.168-.055-.05-.136-.033-.194-.019-.083.02-1.399.889-3.947 2.606-.373.256-.712.381-1.016.375-.334-.007-.978-.19-1.456-.346-.589-.193-1.057-.295-1.017-.624.021-.17.245-.343.673-.522 2.634-1.15 4.395-1.91 5.284-2.28 2.516-1.048 3.039-1.229 3.381-1.235.075-.001.241.017.348.098.079.057.127.164.142.273.024.183-.008.441-.105.777z"/>
                    </svg>
                    Telegram
                </a>
                <a href="https://wa.me/2250506210051" 
                   class="flex items-center justify-center bg-green-500 text-white py-3 px-6 rounded-xl hover:bg-green-600 transform hover:-translate-y-1 transition-all duration-300 font-semibold">
                    <svg class="w-6 h-6 mr-2" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12.031 6.172c-3.181 0-5.767 2.586-5.768 5.766-.001 1.298.38 2.27 1.019 3.287l-.582 2.128 2.182-.573c.978.58 1.911.928 3.145.929 3.178 0 5.767-2.587 5.768-5.766.001-3.187-2.575-5.77-5.764-5.771zm3.392 8.244c-.144.405-.837.774-1.17.824-.299.045-.677.063-1.092-.069-.252-.08-.575-.187-.988-.365-1.739-.751-2.874-2.502-2.961-2.617-.087-.116-.708-.94-.708-1.793s.448-1.273.607-1.446c.159-.173.346-.217.462-.217l.332.006c.106.005.249-.04.39.298.144.347.491 1.2.534 1.287.043.087.072.188.014.304-.058.116-.087.188-.173.289l-.26.304c-.087.086-.177.18-.076.354.101.174.449.741.964 1.201.662.591 1.221.774 1.394.86s.274.072.376-.043c.101-.116.433-.506.549-.68.116-.173.231-.145.39-.087s1.011.477 1.184.564.289.13.332.202c.045.072.045.419-.1.824z"/>
                    </svg>
                    WhatsApp
                </a>
            </div>

            <!-- Bouton de connexion -->
            <button 
                onclick="verifyAccess()"
                class="w-full bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 text-white py-4 rounded-xl hover:shadow-lg transform hover:-translate-y-1 transition-all duration-300 font-bold text-lg"
            >
                Acc√©der √† l'application
            </button>

             <!-- Note pour les utilisateurs internationaux -->
            <p class="text-center mt-4 text-sm text-gray-600">
                Utilisateurs hors C√¥te d'Ivoire : Contactez le support WhatsApp pour la souscription
            </p>
        </div>
    </div>
</div>
  <div class="flex items-center justify-center p-4">
    <div class="prediction-container w-full max-w-4xl p-6">        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">            
            <!-- Colonne Principale -->
            <div class="md:col-span-2">
                <div class="text-center mb-6">
                    <h1 class="text-4xl font-extrabold text-gray-800 flex items-center justify-center">
                        ü§ñ Predicteur Pro 
                        <span class="ml-3 bg-green-500 text-white text-sm px-3 py-1 rounded-full">V2.4</span>
                    </h1>
                    <p class="text-gray-600 mt-2">Pr√©dictions intelligentes avec analyse avanc√©e</p>
                </div>               

                <!-- Zone de Saisie -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <div class="advanced-input">
                        <label class="block text-gray-700 mb-2 font-semibold">C√¥tes (min. 3)</label>
                        <input 
                            type="text" 
                            id="oddsInput" 
                            placeholder="Ex: 1.50, 1.75, 2.00," 
                            class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 transition"
                        >
                        <div class="tooltip">Entrez au moins 3 c√¥tes s√©par√©es par des virgules</div>
                    </div>
                    <div class="advanced-input">
                        <label class="block text-gray-700 mb-2 font-semibold">Mise (‚Ç¨)</label>
                        <input 
                            type="number" 
                            id="betAmount" 
                            placeholder="Montant √† miser" 
                            class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 transition"
                            min="0"
                            step="0.01"
                        >
                        <div class="tooltip">Entrez votre mise pour calculer les gains potentiels</div>
                    </div>
                </div>
                <!-- Boutons -->
                <div class="flex space-x-4 mb-6">
                    <button 
                        onclick="predictOdds()" 
                        class="custom-button flex-grow bg-blue-500 text-white py-3 px-6 rounded-lg hover:bg-blue-600 transition flex items-center justify-center font-semibold"
                    >
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        Analyser
                    </button>
                    <button 
                        onclick="openAdvancedSettings()" 
                        class="custom-button bg-green-500 text-white py-3 px-6 rounded-lg hover:bg-green-600 transition font-semibold"
                    >
                        ‚öôÔ∏è Options
                    </button>
                </div>

                <!-- R√©sultat -->
                <div 
                    id="result" 
                    class="p-6 bg-gradient-to-r from-blue-50 to-green-50 rounded-lg shadow-sm transition-all"
                >
                    <div class="text-center text-gray-600">
                        Entrez vos c√¥tes pour obtenir une pr√©diction
                    </div>
                </div>
                
                <!-- Section R√©cup√©ration Automatique -->
                <div class="auto-fetch-container">
                    <div class="auto-fetch-header">
                        <div class="auto-fetch-title">
                            <i class="fas fa-sync-alt mr-2"></i> R√©cup√©ration Automatique
                        </div>
                        <div class="auto-fetch-status" id="autoFetchStatus">
                            <span class="auto-fetch-dot inactive"></span>
                            <span>Inactif</span>
                        </div>
                    </div>
                    
                    <div class="coefficients-display" id="coefficientsDisplay">
                        <p class="text-center text-gray-500">Les coefficients appara√Ætront ici</p>
                    </div>
                    
                    <div class="auto-fetch-controls">
                        <div class="auto-fetch-btn start" onclick="startAutoFetch()">
                            D√©marrer
                        </div>
                        <div class="auto-fetch-btn stop" onclick="stopAutoFetch()">
                            Arr√™ter
                        </div>
                    </div>
                </div>
            </div>
            <!-- Colonne Statistiques -->
            <div>
                <!-- Stats Rapides -->
                <div class="grid grid-cols-1 gap-4 mb-6">
                    <div class="stat-card">
                        <h4 class="text-sm text-gray-600 font-semibold">Statistiques Globales</h4>
                        <div id="statsContainer">
                            <p id="totalPredictions" class="text-2xl font-bold text-blue-600">0</p>
                            <p id="predictionAccuracy" class="text-xl font-bold text-green-600">0%</p>
                            <div id="statsDetails" class="stats-detail"></div>
                        </div>
                    </div>
                </div>

                <!-- Analyse Intelligence -->
                <div class="stat-card mb-4">
                    <div class="flex justify-between items-center mb-2">
                        <h4 class="text-sm text-gray-600 font-semibold">üß† Analyse Intelligence</h4>
                        <button 
                            onclick="analyzeHistoricalData()" 
                            class="px-2 py-1 bg-purple-500 text-white rounded-lg text-xs hover:bg-purple-600 transition"
                        >
                            Actualiser
                        </button>
                    </div>
                    <div id="intelligentAnalysis" class="text-sm space-y-2">
                        <div class="animate-pulse text-gray-500">
                            Cliquez sur Actualiser pour analyser les donn√©es
                        </div>
                    </div>
                </div>

                <!-- Historique -->
                <div class="bg-white p-4 rounded-lg shadow-sm">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-bold text-gray-800">üìä Historique</h3>
                        <button 
                            id="toggleHistory" 
                            class="px-3 py-1 bg-blue-500 text-white rounded-lg text-sm hover:bg-blue-600 transition"
                            onclick="toggleHistoryVisibility()"
                        >
                            Masquer
                        </button>
                    </div>
                    <div id="predictionHistory" class="space-y-3 max-h-[400px] overflow-y-auto"></div>
                </div>
            </div>
        </div>
        <!-- Graphique -->
        <div class="mt-6 bg-white p-4 rounded-lg shadow-sm">
            <canvas id="statsChart"></canvas>
        </div>
    </div>
</div>

<!-- Footer avec coordonn√©es -->
<footer class="w-full text-center py-6 bg-gray-50 mt-8">
    <div class="space-y-2">
        <p class="text-gray-700 font-semibold">Contactez-nous</p>
        <p class="text-gray-600">
            <a href="tel:+2250506210051" class="hover:text-blue-600 transition">
                üìû +225 05 06 21 00 51
            </a>
        </p>
        <p class="text-gray-600">
            <a href="mailto:dieudonne230@gmail.com" class="hover:text-blue-600 transition">
                ‚úâÔ∏è dieudonne230@gmail.com
            </a>
        </p>
    </div>
</footer>
<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
    // Variables globales
    let predictionHistory = JSON.parse(localStorage.getItem('predictionHistory')) || [];
    let statsChart = null;
    let isHistoryVisible = true;
    
    // Variables pour la r√©cup√©ration automatique des coefficients
    let autoCoefficients = [];
    let autoFetchInterval = null;
    const apiURL = "https://crash-gateway-orc-cr.gamedev-tech.cc/state?id_n=01961b17-0b19-736b-8827-5eb6f27f89bb&id_i=077dee8d-c923-4c02-9bee-757573662e69";
    const headers = { 
        "Authorization": "Bearer 57131fa7-8605-412d-aabd-5066cb5b0fe3",
        "Accept": "application/json",
        "Content-Type": "application/json"
    };

    // Initialisation au chargement de la page
    document.addEventListener('DOMContentLoaded', () => {
        updatePredictionHistory();
        updateStatistics();
        updateStatsChart();
        analyzeHistoricalData();
    });

    // Fonction pour d√©marrer la r√©cup√©ration automatique des coefficients
    function startAutoFetch() {
        if (autoFetchInterval) return; // D√©j√† d√©marr√©
        
        // Mettre √† jour le statut
        const statusElement = document.getElementById('autoFetchStatus');
        statusElement.innerHTML = `
            <span class="auto-fetch-dot"></span>
            <span>R√©cup√©ration en cours...</span>
            <span class="fetching-spinner"></span>
        `;
        
        // D√©marrer l'intervalle
        autoFetchInterval = setInterval(fetchLatestCoefficient, 5000); // Toutes les 3 secondes
        
        // Afficher un message
        Swal.fire({
            icon: 'success',
            title: 'R√©cup√©ration d√©marr√©e',
            text: 'Les coefficients seront r√©cup√©r√©s automatiquement toutes les 5 secondes',
            timer: 2000
        });
    }
    
    // Fonction pour arr√™ter la r√©cup√©ration automatique
    function stopAutoFetch() {
        if (autoFetchInterval) {
            clearInterval(autoFetchInterval);
            autoFetchInterval = null;
            
            // Mettre √† jour le statut
            const statusElement = document.getElementById('autoFetchStatus');
            statusElement.innerHTML = `
                <span class="auto-fetch-dot inactive"></span>
                <span>Inactif</span>
            `;
            
            // Afficher un message
            Swal.fire({
                icon: 'info',
                title: 'R√©cup√©ration arr√™t√©e',
                timer: 1500
            });
        }
    }
    
    // Fonction pour r√©cup√©rer le dernier coefficient
    async function fetchLatestCoefficient() {
        try {
            const response = await fetch(apiURL, { headers });
            if (!response.ok) throw new Error("Erreur API");
            const data = await response.json();
            
            // Acc√®s au coefficient via round_config
            const roundConfig = data.round_config || {};
            const coefficient = data.stop_coefficients?.[0];
            
            if (coefficient) {
                // Convertir 1.00 en 1.01
                const adjustedCoefficient = coefficient === 1.00 ? 1.01 : coefficient;
                
                // Ajouter le coefficient √† la liste
                autoCoefficients.push(adjustedCoefficient.toFixed(2));
                
                // Mettre √† jour l'interface
                updateCoefficientsDisplay();
                
                // Mettre √† jour le champ de saisie
                document.getElementById('oddsInput').value = autoCoefficients.join(', ');
                
                // Si nous avons 5 coefficients, d√©clencher la pr√©diction
                if (autoCoefficients.length >= 5) {
                    predictOdds();
                    
                    // R√©initialiser apr√®s un court d√©lai
                    setTimeout(() => {
                        autoCoefficients = [];
                        updateCoefficientsDisplay();
                        document.getElementById('oddsInput').value = '';
                    }, 1000);
                }
            }
        } catch (error) {
            console.error("Erreur lors de la r√©cup√©ration des coefficients:", error);
            Swal.fire({
                icon: 'error',
                title: 'Erreur',
                text: 'Impossible de r√©cup√©rer les coefficients'
            });
        }
    }
    
    // Fonction pour mettre √† jour l'affichage des coefficients
    function updateCoefficientsDisplay() {
        const displayElement = document.getElementById('coefficientsDisplay');
        
        if (autoCoefficients.length === 0) {
            displayElement.innerHTML = '<p class="text-center text-gray-500">Les coefficients appara√Ætront ici</p>';
            return;
        }
        
        displayElement.innerHTML = `
            <div class="flex flex-wrap justify-center">
                ${autoCoefficients.map(coef => `
                    <div class="coefficient-badge">${coef}</div>
                `).join('')}
            </div>
            <div class="text-center mt-3 text-sm text-gray-600">
                ${5 - autoCoefficients.length} coefficient(s) restant(s) avant pr√©diction
            </div>
        `;
    }

    // Fonction de pr√©diction principale
    function predictOdds() {
        const settings = JSON.parse(localStorage.getItem('predictionSettings')) || {
            analysisMode: 'standard',
            excludeExtremes: false,
            trendAnalysis: false
        };

        const oddsInput = document.getElementById('oddsInput').value;
        const betAmount = parseFloat(document.getElementById('betAmount').value) || 0;
        
        let oddsArray = oddsInput.split(',')
            .map(odd => parseFloat(odd.trim()))
            .filter(odd => !isNaN(odd) && odd > 1);

        if (oddsArray.length < 3) {
            Swal.fire({
                icon: 'error',
                title: 'Donn√©es Insuffisantes',
                text: 'Veuillez entrer au moins 3 c√¥tes valides',
                confirmButtonColor: '#3B82F6'
            });
            return;
        }

        if (settings.excludeExtremes) {
            oddsArray.sort((a, b) => a - b);
            oddsArray = oddsArray.slice(1, -1);
        }

        let averageOdds;
        switch(settings.analysisMode) {
            case 'advanced':
                const weights = oddsArray.map((_, i) => 1 + (i * 0.1));
                const weightedSum = oddsArray.reduce((acc, curr, i) => acc + (curr * weights[i]), 0);
                const weightSum = weights.reduce((acc, curr) => acc + curr, 0);
                averageOdds = weightedSum / weightSum;
                break;
            case 'pro':
                const trend = settings.trendAnalysis ? calculateTrend(oddsArray) : 1;
                averageOdds = (oddsArray.reduce((acc, curr) => acc + curr, 0) / oddsArray.length) * trend;
                break;
            default:
                averageOdds = oddsArray.reduce((acc, curr) => acc + curr, 0) / oddsArray.length;
        }

        const probabilities = oddsArray.map(odd => (1 / odd * 100).toFixed(2));
        const potentialWin = betAmount ? (betAmount * averageOdds).toFixed(2) : 'N/A';

        const predictionResult = {
            id: Date.now(),
            date: new Date().toLocaleString(),
            averageOdds: averageOdds.toFixed(2),
            probabilities: probabilities,
            potentialWin: potentialWin,
            status: 'pending',
            originalOdds: oddsArray.join(', '),
            round: null,
            analysisMode: settings.analysisMode
        };

        predictionHistory.unshift(predictionResult);
        localStorage.setItem('predictionHistory', JSON.stringify(predictionHistory));

        updatePredictionDisplay(predictionResult);
        updatePredictionHistory();
        updateStatistics();
        updateStatsChart();
        analyzeHistoricalData();

        document.getElementById('oddsInput').value = '';
        document.getElementById('betAmount').value = '';

        Swal.fire({
            icon: 'success',
            title: 'Pr√©diction G√©n√©r√©e!',
            html: `
                <div class="text-left">
                    <p>C√¥te moyenne: ${predictionResult.averageOdds}</p>
                    <p class="text-sm text-gray-600">Probabilit√©: ${predictionResult.probabilities[0]}%</p>
                    <p class="text-sm text-gray-600">Mode: ${settings.analysisMode}</p>
                </div>
            `,
            toast: true,
            position: 'top-end',
            showConfirmButton: false,
            timer: 3000
        });
    }
    function calculateTrend(oddsArray) {
        const firstHalf = oddsArray.slice(0, Math.floor(oddsArray.length / 2));
        const secondHalf = oddsArray.slice(Math.floor(oddsArray.length / 2));
        const firstAvg = firstHalf.reduce((acc, curr) => acc + curr, 0) / firstHalf.length;
        const secondAvg = secondHalf.reduce((acc, curr) => acc + curr, 0) / secondHalf.length;
        return 1 + ((secondAvg - firstAvg) / firstAvg);
    }

    function updatePredictionDisplay(prediction) {
        document.getElementById('result').innerHTML = `
            <div class="grid grid-cols-2 gap-4">
                <div class="text-center">
                    <span class="text-sm text-gray-600 block mb-1">C√¥te Probable</span>
                    <p class="text-2xl font-bold text-blue-600">${prediction.averageOdds}</p>
                    <p class="text-sm text-gray-500">${prediction.probabilities[0]}% de chances</p>
                </div>
                <div class="text-center">
                    <span class="text-sm text-gray-600 block mb-1">Probabilit√© de R√©ussite</span>
                    <p class="text-2xl font-bold text-green-600">${prediction.probabilities[0]}%</p>
                </div>
                ${prediction.potentialWin !== 'N/A' ? `
                <div class="col-span-2 text-center mt-2">
                    <span class="text-sm text-gray-600 block mb-1">Gain Potentiel</span>
                    <p class="text-2xl font-bold text-purple-600">${prediction.potentialWin} ‚Ç¨</p>
                </div>` : ''}
            </div>
        `;
    }

    function updatePredictionHistory() {
        const historyContainer = document.getElementById('predictionHistory');
        historyContainer.innerHTML = predictionHistory.map((prediction) => `
            <div class="history-item bg-gray-50 p-3 rounded-lg shadow-sm">
                <div class="flex justify-between items-center mb-2">
                    <div>
                        <p class="font-semibold text-sm">${prediction.date}</p>
                        <p class="text-xs text-gray-600">
                            C√¥te pr√©dite: ${prediction.averageOdds} 
                            <span class="text-blue-600">(${prediction.probabilities[0]}% de chances)</span>
                        </p>
                        <p class="text-xs text-gray-500">C√¥tes d'origine: ${prediction.originalOdds}</p>
                        ${prediction.round ? `
                            <div class="mt-1">
                                <span class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full">
                                    Round ${prediction.round}
                                </span>
                                <span class="text-xs ml-2 ${prediction.status === 'success' 
                                    ? 'bg-green-100 text-green-800' 
                                    : 'bg-red-100 text-red-800'
                                } px-2 py-1 rounded-full">
                                    ${prediction.probabilities[0]}% de pr√©cision
                                </span>
                            </div>
                        ` : ''}
                        <p class="text-xs text-gray-500 mt-1">
                            <span class="bg-gray-100 px-2 py-1 rounded-full">
                                Mode: ${prediction.analysisMode}
                            </span>
                        </p>
                    </div>
                    <div class="flex flex-col items-end space-y-2">
                        ${prediction.status === 'pending' ? `
                            <button 
                                onclick="updatePredictionStatus('${prediction.id}', 'success')" 
                                class="px-2 py-1 bg-green-500 text-white rounded-lg text-xs hover:bg-green-600 transition"
                            >
                                ‚úì Valid√©
                            </button>
                            <button 
                                onclick="updatePredictionStatus('${prediction.id}', 'failed')" 
                                class="px-2 py-1 bg-red-500 text-white rounded-lg text-xs hover:bg-red-600 transition"
                            >
                                ‚úï √âchou√©
                            </button>
                        ` : `
                            <span class="px-3 py-1 rounded-full text-xs ${prediction.status === 'success' 
                                ? 'bg-green-200 text-green-800' 
                                : 'bg-red-200 text-red-800'
                            }">
                                ${prediction.status === 'success' ? '‚úÖ Valid√©' : '‚ùå √âchou√©'}
                            </span>
                        `}
                    </div>
                </div>
            </div>
        `).join('');
    }
    
    function updatePredictionStatus(predictionId, newStatus) {
        const predictionIndex = predictionHistory.findIndex(p => p.id.toString() === predictionId);
        
        if (predictionIndex !== -1) {
            const prediction = predictionHistory[predictionIndex];
            
            if (newStatus === 'success') {
                Swal.fire({
                    title: 'Validation de la Pr√©diction',
                    html: `
                        <div class="mb-4">
                            <p class="text-sm mb-3">Probabilit√© initiale: ${prediction.probabilities[0]}%</p>
                            <label class="block text-gray-700 mb-2">√Ä quel round la pr√©diction a-t-elle √©t√© valid√©e?</label>
                            <select id="roundSelect" class="w-full p-2 border rounded">
                                ${[1,2,3,4,5].map(num => 
                                    `<option value="${num}">Round ${num}</option>`
                                ).join('')}
                            </select>
                        </div>
                    `,
                    confirmButtonText: 'Confirmer',
                    confirmButtonColor: '#3B82F6',
                    showCancelButton: true,
                    cancelButtonText: 'Annuler',
                    allowOutsideClick: false
                }).then((result) => {
                    if (result.isConfirmed) {
                        const selectedRound = document.getElementById('roundSelect').value;
                        predictionHistory[predictionIndex].status = newStatus;
                        predictionHistory[predictionIndex].round = parseInt(selectedRound);
                        
                        localStorage.setItem('predictionHistory', JSON.stringify(predictionHistory));
                        updatePredictionHistory();
                        updateStatistics();
                        updateStatsChart();
                        analyzeHistoricalData();

                        Swal.fire({
                            icon: 'success',
                            title: `Pr√©diction valid√©e au Round ${selectedRound}`,
                            html: `Pr√©cision initiale: ${prediction.probabilities[0]}%`,
                            toast: true,
                            position: 'top-end',
                            showConfirmButton: false,
                            timer: 3000
                        });
                    }
                });
            } else {
                predictionHistory[predictionIndex].status = newStatus;
                localStorage.setItem('predictionHistory', JSON.stringify(predictionHistory));
                updatePredictionHistory();
                updateStatistics();
                updateStatsChart();
                analyzeHistoricalData();
            }
        }
    }
    
    function updateStatistics() {
        const total = predictionHistory.length;
        const completed = predictionHistory.filter(p => p.status !== 'pending').length;
        const success = predictionHistory.filter(p => p.status === 'success').length;
        const failed = predictionHistory.filter(p => p.status === 'failed').length;
        const pending = predictionHistory.filter(p => p.status === 'pending').length;
        
        const accuracy = completed > 0 
            ? ((success / completed) * 100).toFixed(1)
            : '0';

        const statsContainer = document.getElementById('statsContainer');
        statsContainer.innerHTML = `
            <p class="text-2xl font-bold text-blue-600">${total} Pr√©dictions</p>
            <p class="text-xl font-bold text-green-600">${accuracy}% de r√©ussite</p>
            <div class="stats-detail">
                <p>‚úÖ Valid√©es: ${success}</p>
                <p>‚ùå √âchou√©es: ${failed}</p>
                <p>‚è≥ En attente: ${pending}</p>
            </div>
        `;
    }

    function updateStatsChart() {
        const ctx = document.getElementById('statsChart').getContext('2d');
        
        if (statsChart) statsChart.destroy();

        const completedPredictions = predictionHistory.filter(p => p.status !== 'pending').reverse();
        
        statsChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: completedPredictions.map((_, index) => `#${index + 1}`),
                datasets: [{
                    label: 'C√¥tes Moyennes',
                    data: completedPredictions.map(p => parseFloat(p.averageOdds)),
                    borderColor: 'rgb(59, 130, 246)',
                    backgroundColor: 'rgba(59, 130, 246, 0.1)',
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'top',
                    },
                    title: {
                        display: true,
                        text: '√âvolution des Pr√©dictions'
                    }
                },
                scales: {
                    y: {
                        beginAtZero: false
                    }
                }
            }
        });
    }

    function openAdvancedSettings() {
        const currentSettings = JSON.parse(localStorage.getItem('predictionSettings')) || {
            analysisMode: 'standard',
            excludeExtremes: false,
            trendAnalysis: false
        };

        Swal.fire({
            title: 'Param√®tres Avanc√©s',
            html: `
                <div class="grid grid-cols-1 gap-4">
                    <div class="text-left">
                        <label class="block text-gray-700 mb-2">Mode d'Analyse</label>
                        <select id="analysisMode" class="w-full p-2 border rounded">
                            <option value="standard" ${currentSettings.analysisMode === 'standard' ? 'selected' : ''}>
                                Standard (Moyenne simple)
                            </option>
                            <option value="advanced" ${currentSettings.analysisMode === 'advanced' ? 'selected' : ''}>
                                Avanc√© (Pond√©ration adaptative)
                            </option>
                            <option value="pro" ${currentSettings.analysisMode === 'pro' ? 'selected' : ''}>
                                Professionnel (Analyse compl√®te)
                            </option>
                        </select>
                    </div>
                    <div class="text-left">
                        <label class="block text-gray-700 mb-2">Options d'Analyse</label>
                        <div class="space-y-2">
                            <label class="flex items-center">
                                <input type="checkbox" id="excludeExtremes" class="mr-2" 
                                    ${currentSettings.excludeExtremes ? 'checked' : ''}>
                                Exclure les valeurs extr√™mes
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="trendAnalysis" class="mr-2"
                                    ${currentSettings.trendAnalysis ? 'checked' : ''}>
                                Analyse tendancielle
                            </label>
                        </div>
                    </div>
                </div>
            `,
            showCancelButton: true,
            confirmButtonText: 'Sauvegarder',
            cancelButtonText: 'Annuler',
            confirmButtonColor: '#3B82F6',
            cancelButtonColor: '#EF4444',
            preConfirm: () => {
                const settings = {
                    analysisMode: document.getElementById('analysisMode').value,
                    excludeExtremes: document.getElementById('excludeExtremes').checked,
                    trendAnalysis: document.getElementById('trendAnalysis').checked
                };
                localStorage.setItem('predictionSettings', JSON.stringify(settings));
                return settings;
            }
        }).then((result) => {
            if (result.isConfirmed) {
                Swal.fire({
                    icon: 'success',
                    title: 'Param√®tres sauvegard√©s',
                    toast: true,
                    position: 'top-end',
                    showConfirmButton: false,
                    timer: 2000
                });
            }
        });
    }
    function analyzeHistoricalData() {
        const successfulPredictions = predictionHistory.filter(p => p.status === 'success');
        if (successfulPredictions.length === 0) {
            document.getElementById('intelligentAnalysis').innerHTML = `
                <div class="text-gray-500">
                    Pas encore assez de donn√©es pour l'analyse
                </div>
            `;
            return;
        }

        const percentageRanges = analyzePercentageRanges(successfulPredictions);
        const roundAnalysis = analyzeRounds(successfulPredictions);
        const oddsAnalysis = analyzeOddsRanges(successfulPredictions);

        document.getElementById('intelligentAnalysis').innerHTML = `
            <div class="space-y-3">
                <div class="bg-purple-50 p-2 rounded analysis-card">
                    <span class="font-semibold text-purple-800">Meilleur Intervalle de Probabilit√©:</span>
                    <p class="text-purple-600">
                        ${percentageRanges.bestRange}% (${percentageRanges.bestCount} succ√®s)
                        <span class="text-xs text-purple-500">
                            Taux de r√©ussite: ${percentageRanges.successRate}%
                        </span>
                    </p>
                </div>

                <div class="bg-blue-50 p-2 rounded analysis-card">
                    <span class="font-semibold text-blue-800">Round le Plus Performant:</span>
                    <p class="text-blue-600">
                        Round ${roundAnalysis.bestRound} 
                        <span class="text-xs text-blue-500">
                            (${roundAnalysis.roundCount} succ√®s sur ${roundAnalysis.totalForRound} pr√©dictions)
                        </span>
                    </p>
                </div>

                <div class="bg-green-50 p-2 rounded analysis-card">
                    <span class="font-semibold text-green-800">Meilleures C√¥tes:</span>
                    <p class="text-green-600">
                        ${oddsAnalysis.bestRange} 
                        <span class="text-xs text-green-500">
                            (${oddsAnalysis.successCount} succ√®s)
                        </span>
                    </p>
                </div>

                <div class="text-xs text-gray-500 mt-2">
                    Analyse bas√©e sur ${successfulPredictions.length} pr√©dictions r√©ussies
                </div>
            </div>
        `;
    }

    function analyzePercentageRanges(predictions) {
        const ranges = {};
        const allPredictions = predictionHistory.filter(p => p.status !== 'pending');

        allPredictions.forEach(pred => {
            const probability = parseFloat(pred.probabilities[0]);
            const rangeStart = Math.floor(probability / 10) * 10;
            const rangeKey = `${rangeStart}-${rangeStart + 10}`;
            
            if (!ranges[rangeKey]) {
                ranges[rangeKey] = { total: 0, success: 0 };
            }
            ranges[rangeKey].total++;
            if (pred.status === 'success') {
                ranges[rangeKey].success++;
            }
        });

        let bestRange = '';
        let bestCount = 0;
        let bestSuccessRate = 0;

        Object.entries(ranges).forEach(([range, stats]) => {
            const successRate = (stats.success / stats.total) * 100;
            if (stats.success > bestCount || (stats.success === bestCount && successRate > bestSuccessRate)) {
                bestRange = range;
                bestCount = stats.success;
                bestSuccessRate = successRate;
            }
        });

        return {
            bestRange,
            bestCount,
            successRate: bestSuccessRate.toFixed(1)
        };
    }

    function analyzeRounds(predictions) {
        const roundStats = {};
        const allPredictions = predictionHistory.filter(p => p.status !== 'pending' && p.round);

        allPredictions.forEach(pred => {
            if (!roundStats[pred.round]) {
                roundStats[pred.round] = { total: 0, success: 0 };
            }
            roundStats[pred.round].total++;
            if (pred.status === 'success') {
                roundStats[pred.round].success++;
            }
        });

        let bestRound = 0;
        let bestSuccessRate = 0;
        let roundCount = 0;
        let totalForRound = 0;

        Object.entries(roundStats).forEach(([round, stats]) => {
            const successRate = (stats.success / stats.total) * 100;
            if (successRate > bestSuccessRate || (successRate === bestSuccessRate && stats.success > roundCount)) {
                bestRound = round;
                bestSuccessRate = successRate;
                roundCount = stats.success;
                totalForRound = stats.total;
            }
        });
      return {
            bestRound,
            roundCount,
            totalForRound,
            successRate: bestSuccessRate.toFixed(1)
        };
    }

    function analyzeOddsRanges(predictions) {
        const ranges = {};
        predictions.forEach(pred => {
            const odds = parseFloat(pred.averageOdds);
            const rangeStart = Math.floor(odds * 2) / 2;
            const rangeKey = `${rangeStart.toFixed(1)}-${(rangeStart + 0.5).toFixed(1)}`;
            
            ranges[rangeKey] = (ranges[rangeKey] || 0) + 1;
        });

        let bestRange = '';
        let maxSuccess = 0;

        Object.entries(ranges).forEach(([range, count]) => {
            if (count > maxSuccess) {
                bestRange = range;
                maxSuccess = count;
            }
        });

        return {
            bestRange,
            successCount: maxSuccess
        };
    }

    function toggleHistoryVisibility() {
        const historyContainer = document.getElementById('predictionHistory');
        const toggleButton = document.getElementById('toggleHistory');
        isHistoryVisible = !isHistoryVisible;
        
        if (isHistoryVisible) {
            historyContainer.style.display = 'block';
            toggleButton.textContent = 'Masquer';
            toggleButton.classList.remove('bg-green-500', 'hover:bg-green-600');
            toggleButton.classList.add('bg-blue-500', 'hover:bg-blue-600');
        } else {
            historyContainer.style.display = 'none';
            toggleButton.textContent = 'Afficher';
            toggleButton.classList.remove('bg-blue-500', 'hover:bg-blue-600');
            toggleButton.classList.add('bg-green-500', 'hover:bg-green-600');
        }
    }
    
    // V√©rification du code d'acc√®s
    async function verifyAccess() {
        const accessCode = document.getElementById('accessCode').value.trim().toUpperCase();
        
        if (!accessCode) {
            Swal.fire({
                icon: 'error',
                title: 'Erreur',
                text: 'Veuillez entrer un code d\'acc√®s'
            });
            return;
        }

        try {
            const db = firebase.firestore();
            const codesRef = db.collection('codes');
            const query = await codesRef
                .where('code', '==', accessCode)
                .get();

            if (query.empty) {
                Swal.fire({
                    icon: 'error',
                    title: 'Code invalide',
                    text: 'Le code entr√© n\'existe pas ou a expir√©'
                });
                return;
            }

            const codeDoc = query.docs[0];
            const codeData = codeDoc.data();
            const now = new Date();
            const expiration = codeData.dateExpiration.toDate();
            const duration = codeData.duration;

            if (now > expiration) {
                Swal.fire({
                    icon: 'error',
                    title: 'Code expir√©',
                    text: 'Ce code d\'acc√®s a expir√©'
                });
                return;
            }

            if (codeData.utilise) {
                Swal.fire({
                    icon: 'error',
                    title: 'Code d√©j√† utilis√©',
                    text: 'Ce code a d√©j√† √©t√© utilis√©'
                });
                return;
            }

            // Marquer le code comme utilis√©
            await codeDoc.ref.update({
                utilise: true,
                dateUtilisation: now
            });
             // Marquer le code comme utilis√©
            await codeDoc.ref.update({
                utilise: true,
                dateUtilisation: now
            });

            // Sauvegarder dans localStorage
            localStorage.setItem('codeAccess', accessCode);
            localStorage.setItem('accessExpiration', expiration.getTime().toString());
            localStorage.setItem('accessDuration', duration);

            // D√©marrer le compte √† rebours
            startExpirationTimer(expiration);

            document.getElementById('loginModal').style.display = 'none';
            
            Swal.fire({
                icon: 'success',
                title: 'Acc√®s accord√©',
                html: `
                    <p>Bienvenue dans PredictionBot!</p>
                    <p class="text-sm text-gray-600">Dur√©e d'acc√®s : ${duration}</p>
                `,
                timer: 2000,
                showConfirmButton: false
            });

        } catch (error) {
            console.error('Erreur de v√©rification:', error);
            Swal.fire({
                icon: 'error',
                title: 'Erreur',
                text: 'Une erreur est survenue lors de la v√©rification du code'
            });
        }
    }

    // V√©rification initiale de la session
    document.addEventListener('DOMContentLoaded', function() {
        const hasAccess = localStorage.getItem('codeAccess');
        const expiration = localStorage.getItem('accessExpiration');
        const now = new Date().getTime();

        if (hasAccess && expiration && now < parseInt(expiration)) {
            document.getElementById('loginModal').style.display = 'none';
        }

        // Ajouter un √©v√©nement pour la touche Entr√©e
        document.getElementById('accessCode').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                verifyAccess();
            }
        });
    });

    function startExpirationTimer(expirationDate) {
        const daysElement = document.getElementById('days');
        const hoursElement = document.getElementById('hours');
        const minutesElement = document.getElementById('minutes');
        const secondsElement = document.getElementById('seconds');
        const duration = localStorage.getItem('accessDuration');

        document.getElementById('countdownContainer').style.display = 'block';
        
        function updateCountdown() {
            const now = new Date().getTime();
            const distance = expirationDate - now;

            if (distance < 0) {
                localStorage.removeItem('codeAccess');
                localStorage.removeItem('accessExpiration');
                localStorage.removeItem('accessDuration');

                Swal.fire({
                    icon: 'warning',
                    title: 'Session expir√©e',
                    text: 'Votre temps d\'acc√®s est √©coul√©. Vous allez √™tre redirig√©.',
                    allowOutsideClick: false,
                    showConfirmButton: false,
                    timer: 3000
                }).then(() => {
                    document.getElementById('loginModal').style.display = 'flex';
                    document.getElementById('countdownContainer').style.display = 'none';
                    clearInterval(window.countdownInterval);
                    document.getElementById('accessCode').value = '';
                });
                return;
            }

            const days = Math.floor(distance / (1000 * 60 * 60 * 24));
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((distance % (1000 * 60)) / 1000);
            
            daysElement.textContent = days.toString().padStart(2, '0');
            hoursElement.textContent = hours.toString().padStart(2, '0');
            minutesElement.textContent = minutes.toString().padStart(2, '0');
            secondsElement.textContent = seconds.toString().padStart(2, '0');
            
            const allCountdownBoxes = document.querySelectorAll('.countdown-box');
            if (distance < 300000) {
                allCountdownBoxes.forEach(box => box.classList.add('urgent'));
            } else {
                allCountdownBoxes.forEach(box => box.classList.remove('urgent'));
            }
        }

        updateCountdown();
        const countdownInterval = setInterval(updateCountdown, 1000);
        window.countdownInterval = countdownInterval;
    }
    
    // Fonction pour v√©rifier p√©riodiquement la session
    function checkSession() {
        const expiration = localStorage.getItem('accessExpiration');
        if (expiration) {
            const expirationDate = new Date(parseInt(expiration));
            const now = new Date();
            if (now >= expirationDate) {
                localStorage.removeItem('codeAccess');
                localStorage.removeItem('accessExpiration');
                localStorage.removeItem('accessDuration');
                document.getElementById('loginModal').style.display = 'flex';
            }
        }
    }
    
    // Ajouter cette v√©rification p√©riodique au chargement de la page
    document.addEventListener('DOMContentLoaded', function() {
        // V√©rifier la session existante
        const hasAccess = localStorage.getItem('codeAccess');
        const expiration = localStorage.getItem('accessExpiration');
        const now = new Date().getTime();

        if (hasAccess && expiration && now < parseInt(expiration)) {
            document.getElementById('loginModal').style.display = 'none';
            startExpirationTimer(new Date(parseInt(expiration)));
        }
        
        // V√©rifier p√©riodiquement la session
        setInterval(checkSession, 1000);
        
        Swal.fire({
            title: 'üöÄ Guide Complet du Robot de Pr√©diction',
            html: `
                <div class="text-left space-y-4">
                    <div>
                        <h3 class="text-lg font-bold text-blue-600">üìò Compatibilit√© des Jeux</h3>
                        <ul class="list-disc pl-5 text-sm">
                            <li>Aviator</li>
                            <li>Crash</li>
                            <li>Autres jeux similaires √† multiplicateur de c√¥tes</li>
                            <li>Jeux avec progression exponentielle des gains</li>
                            <li>Plateformes de paris en ligne proposant des jeux de type "multiplicateur"</li>
                        </ul>
                    </div>

                    <div>
                        <h3 class="text-lg font-bold text-indigo-600">üìù Comment Entrer les C√¥tes</h3>
                        <div class="bg-indigo-50 p-3 rounded-lg text-sm">
                            <p class="font-bold mb-2">Format d'entr√©e des c√¥tes :</p>
                            <ul class="list-disc pl-5">
                                <li>Entrez les c√¥tes exactement comme elles apparaissent (ex: 1.50, 2.30, 4.50)</li>
                                <li class="text-red-600 font-semibold">Important : Pour un crash √† 1.00, entrez 1.01 (l'algorithme ne prend pas en compte les c√¥tes √† 1.00)</li>
                            </ul>
                        </div>
                    </div>

                    <div>
                        <h3 class="text-lg font-bold text-orange-600">‚öôÔ∏è Param√©trage Recommand√©</h3>
                        <div class="bg-orange-50 p-3 rounded-lg text-sm">
                            <p class="font-bold mb-2">Pour une pr√©cision optimale, configurez les options comme suit :</p>
                            <ul class="list-disc pl-5">
                                <li><span class="font-semibold">Mode d'Analyse :</span> Professionnel (Analyses compl√®tes)</li>
                                <li><span class="font-semibold">Options d'Analyse :</span>
                                    <ul class="list-circle pl-5">
                                        <li>‚úÖ Cocher "Exclure les valeurs extr√™mes"</li>
                                        <li>‚ùå Ne pas cocher "Analyse tendancielle"</li>
                                    </ul>
                                </li>
                            </ul>
                        </div>
                    </div>

                    <div>
                        <h3 class="text-lg font-bold text-green-600">üé≤ Conditions d'Utilisation</h3>
                        <ul class="list-disc pl-5 text-sm">
                            <li>Minimum 3 c√¥tes requises pour une pr√©cision optimale</li>
                            <li>Plus le nombre de c√¥tes est √©lev√©, plus la pr√©diction est pr√©cise</li>
                        </ul>
                    </div>

                    <div>
                        <h3 class="text-lg font-bold text-purple-600">üèÜ Performances et Pr√©cision</h3>
                        <ul class="list-disc pl-5 text-sm">
                            <li>Pr√©dictions entre 80% et 90% : Tr√®s haute probabilit√© de r√©alisation,mais se r√©f√©rer aux donn√©es de l'analyse intelligence</li>
                            <li>La pr√©diction appara√Æt g√©n√©ralement dans les 3 rounds successifs</li>
                        </ul>
                    </div>

                    <div>
                        <h3 class="text-lg font-bold text-red-600">üö® Strat√©gie de Mise Recommand√©e</h3>
                        <ul class="list-disc pl-5 text-sm">
                            <li>Recommand√© : Jouer les c√¥tes  (1.50 √† 2.00)</li>
                            <li>Commencer √† partir du 3√®me round si √©chec aux 2 premiers</li>
                            <li>Utiliser le pari auto avec multiplication de la mise en cas de perte</li>
                            <li>Ne jouer que sur un seul bookmaker √† la fois</li>
                            <li>Pour jouer sur plusieurs sites, utiliser des navigateurs diff√©rents</li>
                        </ul>
                    </div>

                    <div>
                        <h3 class="text-lg font-bold text-yellow-600">üí° Analyse Intelligence</h3>
                        <p class="text-sm">Une fois l'historique suffisant, l'analyse intelligence r√©v√©lera les d√©tails de l'algorithme du jeu en cours pour optimiser vos paris.</p>
                    </div>

                    <div class="bg-green-50 p-3 rounded-lg mt-4">
                        <h3 class="text-lg font-bold text-green-600">üì± Support et Mises √† Jour</h3>
                        <div class="text-sm">
                            <p class="mb-2">Pour ne pas manquer les mises √† jour et obtenir du support :</p>
                            <ul class="list-disc pl-5">
                                <li>WhatsApp : <a href="https://wa.me/2250506210051" class="text-blue-600 font-bold">+225 05 06 21 00 51</a></li>
                                <li>Recevez les nouveaux liens en cas de suspension du site</li>
                                <li>Obtenez de l'aide pour comprendre le fonctionnement</li>
                                <li>Posez vos questions et obtenez des r√©ponses rapides</li>
                            </ul>
                        </div>
                    </div>
                      <div class="bg-gray-100 p-3 rounded-lg mt-4">
                        <p class="text-sm font-bold text-red-500">‚ö†Ô∏è Avertissement</p>
                        <p class="text-xs">Cet outil est une aide √† la d√©cision. Les paris comportent toujours des risques. Misez de mani√®re responsable.</p>
                    </div>
                </div>
            `,
            width: '600px',
            confirmButtonText: 'J\'ai compris',
            confirmButtonColor: '#3B82F6',
            showClass: {
                popup: 'animate__animated animate__fadeInDown'
            },
            hideClass: {
                popup: 'animate__animated animate__fadeOutUp'
            }
        });
    });
</script>
</body>
</html>